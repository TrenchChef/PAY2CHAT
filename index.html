<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pay2Chat - P2P Video Chat</title>
  <style>
    body { font-family: sans-serif; background: #181c20; color: #f5f5f5; margin: 0; padding: 0; }
    .container { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; }
    video { width: 320px; height: 240px; background: #222; margin: 8px; }
    .row { display: flex; gap: 16px; }
    textarea { width: 320px; height: 80px; margin: 8px 0; }
    button { margin: 8px; padding: 8px 16px; font-size: 1rem; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Pay2Chat (Stage 2: Basic Call UI)</h1>
    <div id="homePanel" style="margin:12px 0;">
      <button id="homeCreateBtn">Create Room</button>
      <button id="homeJoinBtn">Join Room</button>
    </div>
    <div class="row">
      <video id="localVideo" autoplay playsinline muted></video>
      <video id="remoteVideo" autoplay playsinline></video>
    </div>
    <div class="row">
      <button id="startBtn">Start Local Media</button>
      <button id="createOfferBtn">Create Offer</button>
      <button id="createAnswerBtn">Create Answer</button>
      <button id="setRemoteBtn">Set Remote SDP</button>
    </div>
    <div class="row">
      <button id="muteBtn" disabled>Mute</button>
      <button id="cameraBtn" disabled>Camera Off</button>
      <button id="endCallBtn" disabled>End Call</button>
      <span id="connState" style="margin-left:16px;"></span>
    </div>
    <div>
      <textarea id="localSDP" placeholder="Local SDP"></textarea>
      <textarea id="remoteSDP" placeholder="Remote SDP"></textarea>
    </div>
    <div>
      <input id="dataMsg" placeholder="Message to send" />
      <button id="sendDataBtn">Send DataChannel Msg</button>
      <div id="dataLog" style="margin-top:8px; min-height:24px;"></div>
    </div>
    <div id="status" style="margin-top:16px;"></div>
      <hr style="width:640px;margin:16px 0;border-color:#333;" />
      <div style="width:640px; text-align:left;">
        <h2>Stage 3: Wallet (Solana)</h2>
        <div style="display:flex;gap:8px;align-items:center;">
        <label for="clusterSelect">Cluster:</label>
        <select id="clusterSelect">
          <option value="mainnet">mainnet-beta</option>
          <option value="devnet">devnet</option>
        </select>
        <label for="customRpc" style="margin-left:8px;">Custom RPC:</label>
        <input id="customRpc" value="https://mainnet.helius-rpc.com/?api-key=87b803b7-48a2-446b-8661-233d33f9cc4d" placeholder="https://api.mainnet-beta.solana.com" style="width:300px" />
        <button id="connectPhantomBtn">Connect Phantom</button>
        <button id="connectSolflareBtn">Connect Solflare</button>
        <button id="connectWCBtn">Connect (WalletConnect)</button>
        <span id="walletAddr"></span>
      </div>
        <div style="margin-top:8px;">
          <strong>USDC Balance:</strong> <span id="usdcBalance">-</span>
          <span id="walletError" style="color:#f66; margin-left:12px;"></span>
          <div id="walletNotes" style="margin-top:6px;color:#ccc; font-size:0.9rem;">MetaMask/EVM wallets are not enabled. Use Phantom or Solflare for Solana USDC. To use WalletConnect for Solana, include a Solana WalletConnect adapter or wallet-adapter integration.</div>
          <div style="margin-top:6px;color:#bbb;font-size:0.85rem;">Helius WebSocket: <code>wss://mainnet.helius-rpc.com/?api-key=87b803b7-48a2-446b-8661-233d33f9cc4d</code></div>
        </div>
        <div style="margin-top:12px;">
          <h3>Stage 4: USDC Transfer Engine (Test)</h3>
          <div style="display:flex;gap:8px;align-items:center;">
            <input id="txRecipient" placeholder="Recipient wallet address" style="flex:1;" />
            <input id="txAmount" placeholder="Amount (USDC)" style="width:120px;" />
            <button id="sendUsdcBtn">Send USDC (test)</button>
          </div>
          <div id="txStatus" style="margin-top:8px;color:#8f8;"></div>
        </div>
        <div style="margin-top:16px;">
            <h3>Stage 5: Room & Prepay (Host / Invitee)</h3>
            <div id="createPanel" style="display:none; margin-top:8px;">
              <div style="display:flex;gap:8px;align-items:center;">
                <label style="width:140px;">Host price / min (USDC):</label>
                <input id="hostPrice" placeholder="e.g. 0.50" style="width:120px;" />
                <button id="createRoomBtn">Create Room (Host)</button>
                <span id="roomInfo" style="margin-left:12px;color:#9f9;"></span>
              </div>
              <div style="margin-top:8px;">
                <h4>Files for sale (Host)</h4>
                <input id="fileNameInput" placeholder="Filename or description" style="width:320px;" />
                <input id="filePriceInput" placeholder="Price (USDC)" style="width:120px;" />
                <button id="addFileBtn">Add File for Sale</button>
                <div id="fileList" style="margin-top:8px;color:#ccc;"></div>
              </div>
            </div>

            <div id="joinPanel" style="display:none; margin-top:8px;">
              <div style="display:flex;gap:8px;align-items:center;">
                <label style="width:140px;">Join Room (paste invite link or code):</label>
                <input id="inviteCodeInput" placeholder="Invite link or code" style="flex:1;" />
                <button id="joinByCodeBtn">Join</button>
              </div>
              <div style="display:flex;gap:8px;align-items:center;margin-top:8px;">
                <label style="width:140px;">Host address (parsed):</label>
                <input id="joinHostAddr" placeholder="Host wallet address" style="flex:1;" />
                <input id="joinPrice" placeholder="Price/min" style="width:120px;" />
                <button id="prepayBtn">Prepay 3 minutes</button>
              </div>
              <div id="prepayStatus" style="margin-top:8px;color:#8f8;"></div>
              <div style="margin-top:8px;">
                <strong>Tip during/after call:</strong>
                <input id="tipAmount" placeholder="Amount (USDC)" style="width:120px; margin-left:8px;" />
                <button id="tipBtn">Send Tip</button>
                <div id="tipStatus" style="margin-top:6px;color:#cfc;"></div>
              </div>
            </div>
            <div id="homeNotice" style="margin-top:8px;color:#ccc;">Use Create Room to set price and generate invite link; use Join Room to paste invite link/code to join.</div>
          </div>
      </div>
  </div>
  <script src="https://unpkg.com/@solana/web3.js@1.73.0/lib/index.iife.min.js"></script>
  <script src="https://unpkg.com/@solana/spl-token@0.3.7/lib/index.iife.min.js"></script>
  <script src="webrtc.js"></script>
</body>
</html>
